<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wabb | Share Your Stories</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<header>
    <div class="logo">Wabb</div>
    <nav>
        <a href="{{ url_for('home') }}">Home</a>
        <a href="{{ url_for('create') }}">Create</a>
        <a href="{{ url_for('library') }}">Library</a>
    </nav>
</header>

<section id="create-story">
    <h2>Create Your Story</h2>
    <form class="story-form">
        <label for="author">Author Name:</label>
        <input type="text" id="author" placeholder="Enter your name">

        <label for="title">Story Title:</label>
        <input type="text" id="title" placeholder="Enter story title">

        <label for="photo">Upload Cover Photo:</label>
        <input type="file" id="photo" accept="image/*">

        <label for="chapter">Chapters:</label>
        <textarea id="chapter" placeholder="Write your story chapters here..."></textarea>

        <button type="button" onclick="publishStory()">Publish Story</button>
    </form>

    <div id="published-story" class="story-output" style="display:none;">
        <h2 id="output-title"></h2>
        <h4 id="output-author"></h4>
        <img id="output-photo" style="max-width: 300px; border-radius: 15px; margin: 20px 0;">
        <h3>Chapters</h3>
        <p id="output-chapter"></p>
        <a href="{{ url_for('library') }}"><button>Go to Library</button></a>
    </div>
</section>

<script>
function publishStory() {
    const author = document.getElementById('author').value.trim();
    const title = document.getElementById('title').value.trim();
    const chapter = document.getElementById('chapter').value.trim();
    const photoInput = document.getElementById('photo');
    const file = photoInput.files[0];

    if (!author || !title || !chapter || !file) {
        alert("Please fill in all fields and upload a photo before publishing!");
        return;
    }

    const reader = new FileReader();
    reader.onload = function(event) {
        const photoData = event.target.result;

        // Save story (with image) to localStorage
        let stories = JSON.parse(localStorage.getItem('stories')) || [];
        stories.push({ title, author, chapter, photo: photoData });
        localStorage.setItem('stories', JSON.stringify(stories));

        // Display story preview
        document.getElementById('output-title').textContent = title;
        document.getElementById('output-author').textContent = "by " + author;
        document.getElementById('output-chapter').textContent = chapter;
        document.getElementById('output-photo').src = photoData;

        document.querySelector('.story-form').style.display = 'none';
        document.getElementById('published-story').style.display = 'block';

        alert("ðŸŽ‰ Story published! Itâ€™s now in your Library.");
    };

    reader.readAsDataURL(file);
}
</script>

</body>
</html>
